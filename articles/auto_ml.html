<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="agua">
<title>Automatic machine learning • agua</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Source%20Sans%20Pro-0.4.1/font.css" rel="stylesheet">
<link href="../deps/_Source%20Code%20Pro-0.4.1/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Automatic machine learning">
<meta property="og:description" content="agua">
<meta property="og:image" content="https://agua.tidymodels.org/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="agua.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">agua</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/agua.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/auto_ml.html">Automatic machine learning</a>
    <a class="dropdown-item" href="../articles/tune.html">Model tuning</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidymodels/agua/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Automatic machine learning</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/agua/blob/HEAD/vignettes/articles/auto_ml.Rmd" class="external-link"><code>vignettes/articles/auto_ml.Rmd</code></a></small>
      <div class="d-none name"><code>auto_ml.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="using-h2o-automl">Using H2O AutoML<a class="anchor" aria-label="anchor" href="#using-h2o-automl"></a>
</h2>
<p>Automatic machine learning (AutoML) is the process of automatically searching, screening and evaluating many models for a specific dataset. AutoML could be particularly insightful as an exploratory approach to identify model families and parameterization that is most likely to succeed. You can use H2O’s <a href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/automl.html" class="external-link">AutoML</a> algorithm via the <code>'h2o'</code> engine in <code><a href="https://parsnip.tidymodels.org/reference/auto_ml.html" class="external-link">auto_ml()</a></code>. agua provides several helper functions to quickly wrangle and visualize AutoML’s results.</p>
<p>Let’s run an AutoML search on the concrete data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://agua.tidymodels.org/">agua</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/h2o-server.html">h2o_start</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">concrete</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4595</span><span class="op">)</span></span>
<span><span class="va">concrete_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">concrete</span>, strata <span class="op">=</span> <span class="va">compressive_strength</span><span class="op">)</span></span>
<span><span class="va">concrete_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">concrete_split</span><span class="op">)</span></span>
<span><span class="va">concrete_test</span> <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">concrete_split</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run for a maximum of 120 seconds</span></span>
<span><span class="va">auto_spec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/auto_ml.html" class="external-link">auto_ml</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"h2o"</span>, max_runtime_secs <span class="op">=</span> <span class="fl">120</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">normalized_rec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">compressive_strength</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">concrete_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">step_normalize</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">auto_wflow</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">auto_spec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">normalized_rec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">auto_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">auto_wflow</span>, data <span class="op">=</span> <span class="va">concrete_train</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_fit_parsnip</a></span><span class="op">(</span><span class="va">auto_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; parsnip model object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ═════════════════════ H2O AutoML Summary: 105 models ═════════════════════ </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; ═══════════════════════════════ Leaderboard ══════════════════════════════ </span></span>
<span><span class="co">#&gt;                                                  model_id rmse  mse  mae</span></span>
<span><span class="co">#&gt; 1 StackedEnsemble_BestOfFamily_4_AutoML_1_20220712_204537 4.49 20.1 2.90</span></span>
<span><span class="co">#&gt; 2        XGBoost_grid_1_AutoML_1_20220712_204537_model_38 4.61 21.3 3.03</span></span>
<span><span class="co">#&gt; 3    StackedEnsemble_AllModels_2_AutoML_1_20220712_204537 4.62 21.4 3.04</span></span>
<span><span class="co">#&gt; 4    StackedEnsemble_AllModels_1_AutoML_1_20220712_204537 4.67 21.8 3.08</span></span>
<span><span class="co">#&gt; 5        XGBoost_grid_1_AutoML_1_20220712_204537_model_39 4.68 21.9 3.14</span></span>
<span><span class="co">#&gt; 6 StackedEnsemble_BestOfFamily_3_AutoML_1_20220712_204537 4.68 21.9 3.08</span></span>
<span><span class="co">#&gt;   rmsle mean_residual_deviance</span></span>
<span><span class="co">#&gt; 1 0.136                   20.1</span></span>
<span><span class="co">#&gt; 2 0.143                   21.3</span></span>
<span><span class="co">#&gt; 3 0.140                   21.4</span></span>
<span><span class="co">#&gt; 4 0.142                   21.8</span></span>
<span><span class="co">#&gt; 5 0.146                   21.9</span></span>
<span><span class="co">#&gt; 6 0.142                   21.9</span></span></code></pre></div>
<p>In 120 seconds, AutoML fitted 105 models. The parsnip fit object <code>extract_fit_parsnip(auto_fit)</code> shows the number of candidate models, the best performing algorithm and its corresponding model id, and a preview of the leaderboard with cross validation performances. The <code>model_id</code> column in the leaderboard is a unique model identifier for the h2o server. This can be useful when you need to predict on or extract a specific model, e.g. with <code>predict(auto_fit, id = id)</code> and <code>extract_fit_engine(auto_fit, id = id)</code>. By default, they will operate on the best performing leader model.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># predict with the best model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">auto_fit</span>, new_data <span class="op">=</span> <span class="va">concrete_test</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 260 × 1</span></span></span>
<span><span class="co">#&gt;    .pred</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  41.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  43.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  37.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  55.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  41.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  27.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  52.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  36.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  52.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  39.4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 250 more rows</span></span></span></code></pre></div>
<p>Typically, we use AutoML to get a quick sense of the range of our success metric, and algorithms that are likely to succeed. agua provides tools to summarize these results.</p>
<ul>
<li>
<code><a href="https://generics.r-lib.org/reference/rank_results.html" class="external-link">rank_results()</a></code> returns the leaderboard in a tidy format with rankings within each metric. A low rank means good performance in a metric. Here, the top 5 models with the smallest MAE includes are four stacked ensembles and one GBM model.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/rank_results.html" class="external-link">rank_results</a></span><span class="op">(</span><span class="va">auto_fit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"mae"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="va">rank</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 105 × 5</span></span></span>
<span><span class="co">#&gt;    id                                        algorithm .metric  mean  rank</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> StackedEnsemble_BestOfFamily_4_AutoML_1_… stacking  mae      2.91     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> XGBoost_grid_1_AutoML_1_20220712_204537_… xgboost   mae      3.03     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> StackedEnsemble_AllModels_2_AutoML_1_202… stacking  mae      3.04     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> StackedEnsemble_BestOfFamily_3_AutoML_1_… stacking  mae      3.08     4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> StackedEnsemble_AllModels_1_AutoML_1_202… stacking  mae      3.09     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> XGBoost_grid_1_AutoML_1_20220712_204537_… xgboost   mae      3.13     6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> XGBoost_grid_1_AutoML_1_20220712_204537_… xgboost   mae      3.13     7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> XGBoost_grid_1_AutoML_1_20220712_204537_… xgboost   mae      3.14     8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> GBM_5_AutoML_1_20220712_204537            gradient… mae      3.15     9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> StackedEnsemble_BestOfFamily_2_AutoML_1_… stacking  mae      3.17    10</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 95 more rows</span></span></span></code></pre></div>
<ul>
<li>
<code><a href="https://tune.tidymodels.org/reference/collect_predictions.html" class="external-link">collect_metrics()</a></code> returns average statistics of performance metrics (summarized) per model, or raw value for each resample (unsummarized). <code>cv_id</code> identifies the resample h2o internally used for optimization.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html" class="external-link">collect_metrics</a></span><span class="op">(</span><span class="va">auto_fit</span>, summarize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,715 × 5</span></span></span>
<span><span class="co">#&gt;    id                                    algorithm .metric cv_id .estimate</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> StackedEnsemble_BestOfFamily_4_AutoM… stacking  mae     cv_1…      2.68</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> StackedEnsemble_BestOfFamily_4_AutoM… stacking  mae     cv_2…      2.51</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> StackedEnsemble_BestOfFamily_4_AutoM… stacking  mae     cv_3…      3.09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> StackedEnsemble_BestOfFamily_4_AutoM… stacking  mae     cv_4…      3.24</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> StackedEnsemble_BestOfFamily_4_AutoM… stacking  mae     cv_5…      3.02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> StackedEnsemble_BestOfFamily_4_AutoM… stacking  mean_r… cv_1…     16.2 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> StackedEnsemble_BestOfFamily_4_AutoM… stacking  mean_r… cv_2…     17.3 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> StackedEnsemble_BestOfFamily_4_AutoM… stacking  mean_r… cv_3…     20.0 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> StackedEnsemble_BestOfFamily_4_AutoM… stacking  mean_r… cv_4…     26.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> StackedEnsemble_BestOfFamily_4_AutoM… stacking  mean_r… cv_5…     20.8 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 3,705 more rows</span></span></span></code></pre></div>
<ul>
<li>
<code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code> returns a tibble with performance and individual model objects. This is helpful if you want to perform operations (e.g., predict) across all candidates.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">auto_fit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    .predictions <span class="op">=</span> <span class="fu">map</span><span class="op">(</span><span class="va">.model</span>, <span class="va">predict</span>, new_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">concrete_test</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 105 × 5</span></span></span>
<span><span class="co">#&gt;    id                             algorithm .metric  .model   .predictions</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> StackedEnsemble_BestOfFamily_… stacking  &lt;tibble&gt; <span style="color: #949494;">&lt;fit[+]&gt;</span> &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> XGBoost_grid_1_AutoML_1_20220… xgboost   &lt;tibble&gt; <span style="color: #949494;">&lt;fit[+]&gt;</span> &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> StackedEnsemble_AllModels_2_A… stacking  &lt;tibble&gt; <span style="color: #949494;">&lt;fit[+]&gt;</span> &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> StackedEnsemble_AllModels_1_A… stacking  &lt;tibble&gt; <span style="color: #949494;">&lt;fit[+]&gt;</span> &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> XGBoost_grid_1_AutoML_1_20220… xgboost   &lt;tibble&gt; <span style="color: #949494;">&lt;fit[+]&gt;</span> &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> StackedEnsemble_BestOfFamily_… stacking  &lt;tibble&gt; <span style="color: #949494;">&lt;fit[+]&gt;</span> &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> StackedEnsemble_BestOfFamily_… stacking  &lt;tibble&gt; <span style="color: #949494;">&lt;fit[+]&gt;</span> &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> XGBoost_grid_1_AutoML_1_20220… xgboost   &lt;tibble&gt; <span style="color: #949494;">&lt;fit[+]&gt;</span> &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> XGBoost_grid_1_AutoML_1_20220… xgboost   &lt;tibble&gt; <span style="color: #949494;">&lt;fit[+]&gt;</span> &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> GBM_5_AutoML_1_20220712_204537 gradient… &lt;tibble&gt; <span style="color: #949494;">&lt;fit[+]&gt;</span> &lt;tibble&gt;    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 95 more rows</span></span></span></code></pre></div>
<ul>
<li>
<code><a href="../reference/automl-tools.html">member_weights()</a></code> computes member importance for all stacked ensemble models. Aside from base models such as GLM, GBM and neural networks, h2o tries to fit two kinds of stacked ensembles: one combines the all base models (<code>"all"</code>) and the other includes only the best model of each kind (<code>"bestofFamily"</code>), specific to a time point. Regardless of how ensembles are formed, we can calculate the variable importance in the ensemble as the importance score of every member model, i.e., the relative contribution of base models in the meta-learner. This is typically the coefficient magnitude in a second-level GLM. This way, in addition to inspecting model performances by themselves, we can find promising candidates if stacking is needed. Here, we show the scaled contribution of different algorithms in stacked ensembles.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">auto_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_fit_parsnip</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/automl-tools.html">member_weights</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">importance</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"scaled_importance"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">algorithm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_sqrt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="cn">NULL</span>, x <span class="op">=</span> <span class="st">"scaled importance"</span>, title <span class="op">=</span> <span class="st">"Member importance in stacked ensembles"</span><span class="op">)</span></span></code></pre></div>
<p><img src="auto_ml_files/figure-html/auto-stacked-1.png" width="95%"></p>
<p>You can also <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code> an AutoML object, which essentially wraps functions above to plot performance assessment and ranking. The lower the average ranking, the more likely the model type suits the data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">auto_fit</span>, type <span class="op">=</span> <span class="st">"rank"</span>, metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mae"</span>, <span class="st">"rmse"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="auto_ml_files/figure-html/autoplot-1.png" width="95%"></p>
<p>After initial assessment, we might be interested to allow more time for AutoML to search for more candidates. Recall that we have set engine argument <code>max_runtime_secs</code> to 120s before, we can increase it or adjust <code>max_models</code> to control the total runtime. H2O also provides an option to build upon an existing AutoML leaderboard and add more candidates, this can be done via <code><a href="https://generics.r-lib.org/reference/refit.html" class="external-link">refit()</a></code>. The model to be re-fitted needs to have engine argument <code>save_data = TRUE</code>. If you also want to add stacked ensembles set <code>keep_cross_validation_predictions = TRUE</code> as well.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># not run </span></span>
<span><span class="va">auto_spec_refit</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/auto_ml.html" class="external-link">auto_ml</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"h2o"</span>, </span>
<span>             max_runtime_secs <span class="op">=</span> <span class="fl">300</span>, </span>
<span>             save_data <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             keep_cross_validation_predictions <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">auto_wflow_refit</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">auto_spec_refit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">normalized_rec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">first_auto</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">auto_wflow_refit</span>, data <span class="op">=</span> <span class="va">concrete_train</span><span class="op">)</span></span>
<span><span class="co"># fit another 60 seconds </span></span>
<span><span class="va">second_auto</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/refit.html" class="external-link">refit</a></span><span class="op">(</span><span class="va">first_auto</span>, max_runtime_secs <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="important-engine-arguments">Important engine arguments<a class="anchor" aria-label="anchor" href="#important-engine-arguments"></a>
</h2>
<p>There are several relevant engine arguments for H2O AutoML, some of the most commonly used are:</p>
<ul>
<li><p><code>max_runtime_secs</code> and <code>max_models</code>: Adjust runtime.</p></li>
<li><p><code>include_algos</code> and <code>exclude_algos</code>: A character vector naming the algorithms to include or exclude.</p></li>
<li><p><code>validation</code>: An integer between 0 and 1 specifying the proportion of training data reserved as validation set. This is used by h2o for performance assessment and potential early stopping.</p></li>
</ul>
<p>See the details section in <code><a href="https://rdrr.io/pkg/h2o/man/h2o.automl.html" class="external-link">h2o::h2o.automl()</a></code> for more information.</p>
</div>
<div class="section level2">
<h2 id="limiations">Limiations<a class="anchor" aria-label="anchor" href="#limiations"></a>
</h2>
<p>One current limitation of H2O AutoML models is that they can’t be used in resampling. This means you can’t use them with <code>fit_resamples()</code>, <code>tune_grid()</code>, <code>tune_bayes()</code>, etc.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, Qiushi Yan, Steven Pawley.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

  </div></footer>
</body>
</html>
