<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="agua">
<title>Model tuning • agua</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Source%20Sans%20Pro-0.4.1/font.css" rel="stylesheet">
<link href="../deps/_Source%20Code%20Pro-0.4.1/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Model tuning">
<meta property="og:description" content="agua">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="agua.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">agua</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/agua.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/auto_ml.html">Automatic machine learning</a>
    <a class="dropdown-item" href="../articles/tune.html">Model tuning</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidymodels/agua/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Model tuning</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/agua/blob/HEAD/vignettes/articles/tune.Rmd" class="external-link"><code>vignettes/articles/tune.Rmd</code></a></small>
      <div class="d-none name"><code>tune.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="hyper-parameter-tuning-with-agua">Hyper-parameter tuning with agua<a class="anchor" aria-label="anchor" href="#hyper-parameter-tuning-with-agua"></a>
</h2>
<p>agua sets up the infrastructure for the tune package to enable optimization of h2o models. Similar to other models, we label the hyperparameter with the <code><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune()</a></code> placeholder and feed them into <code>tune_*()</code> functions such as <code>tune_grid()</code> and <code>tune_bayes()</code>. We will use the tuning example from <a href="https://tune.tidymodels.org/articles/tune.html" class="external-link">Introduction to tune</a> with the Ames housing data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://agua.tidymodels.org/">agua</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">doParallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html" class="external-link">registerDoParallel</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/h2o-server.html">h2o_start</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ames</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">4595</span><span class="op">)</span></span>
<span><span class="va">data_split</span> <span class="op">&lt;-</span> <span class="va">ames</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Sale_Price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/h2o/man/H2OFrame.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">initial_split</span><span class="op">(</span>strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span></span>
<span><span class="va">ames_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span></span>
<span><span class="va">ames_test</span>  <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">data_split</span><span class="op">)</span></span>
<span><span class="va">cv_splits</span> <span class="op">&lt;-</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="va">ames_train</span>, v <span class="op">=</span> <span class="fl">10</span>, strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_rec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Gr_Liv_Area</span> <span class="op">+</span> <span class="va">Longitude</span> <span class="op">+</span> <span class="va">Latitude</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">step_log</span><span class="op">(</span><span class="va">Gr_Liv_Area</span>, base <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">step_ns</span><span class="op">(</span><span class="va">Longitude</span>, deg_free <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="st">"long df"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">step_ns</span><span class="op">(</span><span class="va">Latitude</span>,  deg_free <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="st">"lat df"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/linear_reg.html" class="external-link">linear_reg</a></span><span class="op">(</span>penalty <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html" class="external-link">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"h2o"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_wflow</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">lm_mod</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">ames_rec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="va">lm_wflow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_parameter_set_dials</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">grid_regular</span><span class="op">(</span>levels <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_res</span> <span class="op">&lt;-</span> <span class="fu">tune_grid</span><span class="op">(</span></span>
<span>  <span class="va">lm_wflow</span>, </span>
<span>  resamples <span class="op">=</span> <span class="va">cv_splits</span>, </span>
<span>  grid <span class="op">=</span> <span class="va">grid</span>, </span>
<span>  control <span class="op">=</span> <span class="fu">control_grid</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_res</span> </span></code></pre></div>
<pre><code><span><span class="co">## # Tuning results</span></span>
<span><span class="co">## # 10-fold cross-validation using stratification </span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 10 × 5</span></span></span>
<span><span class="co">##    splits             id     .metrics           .notes   .predictions</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold01 <span style="color: #949494;">&lt;tibble [250 × 7]&gt;</span> &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold02 <span style="color: #949494;">&lt;tibble [250 × 7]&gt;</span> &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold03 <span style="color: #949494;">&lt;tibble [250 × 7]&gt;</span> &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">&lt;split [1976/221]&gt;</span> Fold04 <span style="color: #949494;">&lt;tibble [250 × 7]&gt;</span> &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">&lt;split [1977/220]&gt;</span> Fold05 <span style="color: #949494;">&lt;tibble [250 × 7]&gt;</span> &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">&lt;split [1977/220]&gt;</span> Fold06 <span style="color: #949494;">&lt;tibble [250 × 7]&gt;</span> &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">&lt;split [1978/219]&gt;</span> Fold07 <span style="color: #949494;">&lt;tibble [250 × 7]&gt;</span> &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">&lt;split [1978/219]&gt;</span> Fold08 <span style="color: #949494;">&lt;tibble [250 × 7]&gt;</span> &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">&lt;split [1979/218]&gt;</span> Fold09 <span style="color: #949494;">&lt;tibble [250 × 7]&gt;</span> &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">&lt;split [1980/217]&gt;</span> Fold10 <span style="color: #949494;">&lt;tibble [250 × 7]&gt;</span> &lt;tibble&gt; &lt;tibble&gt;    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## There were issues with some computations:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   - Warning(s) x10: A correlation computation is required, but `estimate` is co...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Run `show_notes(.Last.tune.result)` for more information.</span></span></code></pre>
<p>The syntax is the same, we provide a workflow and the grid of hyper-parameters, then <code>tune_grid()</code> returns cross validation performances for every parameterization per resample. There are two small differences to note when tuning h2o models:</p>
<ul>
<li><p>Remember to call <code><a href="../reference/h2o-server.html">h2o_start()</a></code> beforehand to enable all the h2o side of computations.</p></li>
<li><p>h2o supports only a regular grid of hyper-parameters, as created by <code><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid()</a></code>, see <code><a href="https://dials.tidymodels.org/reference/grid_regular.html" class="external-link">?dials::grid_regular</a></code> for more details. As such we need to set <code>grid</code> in <code>tune_*()</code> functions explicitly to be a data frame of regular grid and prevent the default grid generation.</p></li>
</ul>
<p>Other functions in tune for working with tuning results such as <code><a href="https://tune.tidymodels.org/reference/collect_predictions.html" class="external-link">collect_metrics()</a></code>, <code>collect_predictions()</code> and <code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot()</a></code> will also recognize <code>ames_res</code> and work as expected.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html" class="external-link">collect_metrics</a></span><span class="op">(</span><span class="va">ames_res</span>, summarize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2,500 × 8</span></span></span>
<span><span class="co">##    id      penalty `long df` `lat df` .metric .estimator .estimate .config</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> Fold01    1<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span>         1        1 rmse    standard      0.115  Prepro…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> Fold01    1<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span>         1        1 rsq     standard      0.550  Prepro…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> Fold02    1<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span>         1        1 rmse    standard      0.112  Prepro…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> Fold02    1<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span>         1        1 rsq     standard      0.603  Prepro…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> Fold03    1<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span>         1        1 rmse    standard      0.116  Prepro…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> Fold03    1<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span>         1        1 rsq     standard      0.563  Prepro…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> Fold04    1<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span>         1        1 rmse    standard      0.112  Prepro…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> Fold04    1<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span>         1        1 rsq     standard      0.581  Prepro…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> Fold05    1<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span>         1        1 rmse    standard      0.099<span style="text-decoration: underline;">8</span> Prepro…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> Fold05    1<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span>         1        1 rsq     standard      0.637  Prepro…</span></span>
<span><span class="co">## <span style="color: #949494;"># … with 2,490 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">ames_res</span>, metric <span class="op">=</span> <span class="st">"rmse"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tune_files/figure-html/unnamed-chunk-3-1.png" width="768"></p>
<p>One current limitation with parallel processing is that parallelization on the R side is done over resamples, i.e., <code>control = control_grid(parallel_over = 'resamples')</code>. We can’t set <code>parallel_over = 'everything'</code> for an inner parallel loop of tuning parameters. Yet the h2o server by can build models in parallel with adaptive parallelism.</p>
<p><strong>TODO</strong>: how to use <code>parallelism</code> in <code><a href="https://rdrr.io/pkg/h2o/man/h2o.grid.html" class="external-link">h2o::h2o.grid</a></code></p>
</div>
<div class="section level2">
<h2 id="tuning-internals">Tuning internals<a class="anchor" aria-label="anchor" href="#tuning-internals"></a>
</h2>
<p>For users interested to understand the limitations and performance characteristics of tuning h2o models with agua, it is helpful to know some inner workings of h2o. agua uses the <code><a href="https://rdrr.io/pkg/h2o/man/h2o.grid.html" class="external-link">h2o::h2o.grid()</a></code> function for tuning model parameters, which accepts a list of hyper-parameters, construct a regular grid, and search for the optimal combination for a given dataset.</p>
<p>In the above example, we have three tuning parameters of two types:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_parameter_set_dials</a></span><span class="op">(</span><span class="va">lm_wflow</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Collection of 3 parameters for tuning</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  identifier     type    object</span></span>
<span><span class="co">##     penalty  penalty nparam[+]</span></span>
<span><span class="co">##     long df deg_free nparam[+]</span></span>
<span><span class="co">##      lat df deg_free nparam[+]</span></span></code></pre>
<ul>
<li><p>tuning parameters in the model: <code>penalty</code>.</p></li>
<li><p>tuning parameters in the preprocessor: <code>long df</code> and <code>lat df</code>.</p></li>
</ul>
<p>Since <code>h2o.grid</code> does not optimize parameters in the preprocessor, possible values of <code>long df</code> and <code>lat df</code> in <code>grid</code> will be iterated as usual on the R side. Once a certain combination of them is chosen, agua will engineer all the relevant features, convert <code>grid</code> to a list of hyper-parameters, then passes the data and model definitions to <code>h2o_grid()</code>. Next, <code><a href="https://rdrr.io/pkg/h2o/man/h2o.grid.html" class="external-link">h2o.grid()</a></code> conducts a series of validations to prepare data for the server, one of which is an <code><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid()</a></code> on the list of hyper-parameters to generate a regular grid. After this, we have completed computations on the R side and the rest of model tuning is now delegated to the h2o server.</p>
<p>If you have a parallel backend registered, models will be optimized and evaluated in parallel per resample. The h2o server would still require the complete set of parameters for one resample. For this reason, agua does not support <code>parallel_over = 'everything'</code> on the R side.</p>
<p>Regarding the performance of model evaluation, <code><a href="https://rdrr.io/pkg/h2o/man/h2o.grid.html" class="external-link">h2o.grid()</a></code> supports passing in a validation frame but does not return predictions on that data. In order to compute metrics on the holdout sample, we have to retrieve the model, convert validation data into the desired format, predict on it, and convert the results back to data frames. In the future we hope to get validation predictions directly thus eliminating excessive data conversions.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, Qiushi Yan, Steven Pawley.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

  </div></footer>
</body>
</html>
